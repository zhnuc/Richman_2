# Rich 大富翁游戏

## 🎯 项目简介

基于C语言开发的70个位置大富翁游戏，支持4个角色、多种道具、特殊建筑和完整的游戏机制。采用模块化设计，支持多人协作开发和测试驱动开发（TDD）。

### 🌟 核心特性
- **70个位置**的完整游戏地图
- **4个经典角色**：钱夫人、阿土伯、孙小美、金贝贝
- **3种道具系统**：路障、炸弹、机器娃娃
- **5个特殊建筑**：道具屋、礼品屋、医院、监狱、魔法屋
- **完整房产系统**：购买、升级、过路费、出售
- **preset初始化**：支持预设游戏状态

## 📁 项目结构

```
Richman_2/
├── src/                          # 源代码目录
│   ├── main.c                    # 主程序入口
│   ├── game/                     # 游戏逻辑模块
│   │   ├── game_types.h          # 核心数据结构定义
│   │   ├── game_state.h/c        # 游戏状态管理
│   │   ├── player.h/c            # 玩家管理
│   │   └── character.h/c         # 角色管理
│   ├── io/                       # 输入输出模块
│   │   ├── command_processor.h/c # 命令行处理和游戏主循环
│   │   └── json_serializer.h/c   # JSON序列化和preset加载
│   └── utils/                    # 工具函数模块
│       └── string_utils.h/c      # 字符串工具
├── tests/                        # 测试目录
│   ├── integration/              # 集成测试用例
│   │   ├── test_startup_001/     # 启动测试用例1（钱夫人）
│   │   │   ├── input.txt         # 输入命令序列
│   │   │   ├── expected_result.json # 期望JSON状态
│   │   │   ├── output.txt        # 实际输出（调试用）
│   │   │   └── dump.json         # 实际JSON状态
│   │   ├── test_startup_006/     # preset初始化测试1
│   │   │   ├── input.txt         # 输入命令序列
│   │   │   ├── preset.json       # 初始游戏状态
│   │   │   ├── expected_result.json # 期望JSON状态
│   │   │   ├── output.txt        # 实际输出（调试用）
│   │   │   └── dump.json         # 实际JSON状态
│   │   └── ...                   # 其他测试用例
│   └── scripts/                  # 测试脚本
│       └── run_integration_tests.py # 自动化集成测试
├── Makefile                      # 构建脚本
├── README.md                     # 项目说明
├── DEVELOPMENT_GUIDE.md          # 详细开发指南
└── QUICK_REFERENCE.md            # 快速参考
```

## 🚀 快速开始

### 编译游戏
```bash
make              # 编译游戏程序
make clean        # 清理构建文件
```

### 运行游戏
```bash
./rich            # 启动游戏
```

### 运行测试
```bash
make test         # 运行敏捷测试（推荐）
make integration_test  # 运行所有测试（包括未实现功能）
make test_status  # 查看测试状态配置
```

### 敏捷测试管理
项目采用智能测试状态管理，支持：
- 🟢 **active**: 已实现功能的测试，正常执行
- 🔵 **pending**: 待实现功能的测试，暂时跳过
- 🟡 **wip**: 开发中功能的测试，允许失败
- ⚫ **disabled**: 已禁用的测试，完全跳过

```bash
# 标记测试状态
make mark_test TEST=test_name STATUS=pending|active|wip|disabled
```

## 🎮 游戏使用说明

### 启动游戏
```bash
./rich              # 启动游戏
```

### 游戏初始化
1. **设置初始资金**（如果没有preset.json）
   ```
   请输入初始资金: 10000
   ```

2. **选择角色**
   ```
   欢迎来到大富翁，请按数字键选择你的角色：
   1.钱夫人  2.阿土伯  3.孙小美  4.金贝贝
   请输入选择 (1-4): 1
   ```

3. **或使用preset.json**
   - 在游戏目录放置preset.json文件
   - 游戏将自动加载预设状态

### 基础命令
- `roll` - 掷骰子移动（1-6步）
- `step n` - 指定移动n步
- `query` - 查询当前状态
- `dump` - 保存游戏状态到dump.json
- `help` - 显示帮助信息
- `quit` - 退出游戏

### 地产命令
- `buy` - 购买当前位置空地
- `upgrade n` - 升级指定位置房产
- `sell n` - 出售指定位置房产

### 道具命令
- `block n` - 在相对位置n放置路障
- `bomb n` - 在相对位置n放置炸弹
- `robot` - 使用机器娃娃清除前方道具

## 🤝 团队协作

### 团队成员
**测试开发团队（3人）**：
- 张昊楠（测试负责人）- 框架测试、地产系统、游戏流程
- 岳康（测试开发）- 移动系统、房产系统、道具系统  
- 柏昱彤（测试开发）- 查询系统、特殊建筑、边界测试

**功能开发团队（4人）**：
- 邵冰沁（开发负责人）- 项目架构、核心系统
- 李云泽（核心开发）- 游戏逻辑、算法实现
- 张弛（功能开发）- 地图系统、道具效果、魔法屋
- 吴浩闻（功能开发）- 命令解析、存档系统、性能优化

### 开发模式
- **并行开发**：7人同时工作，模块化分工
- **测试驱动**：测试用例引导开发进度
- **持续集成**：每日集成测试，及时发现问题
- **版本控制**：严格的分支管理和代码审查

### 协作原则

#### 1. **主程序稳定性**
- `src/main.c` 保持极简，基本不修改
- 所有功能通过模块接口调用
- 避免直接修改主程序逻辑

#### 2. **接口优先**
- 修改功能前先确定接口（头文件）
- 接口变更需要团队讨论
- 保持向后兼容性

#### 3. **独立开发**
- 每个模块可以独立开发和测试
- 通过头文件约定接口
- 减少模块间的直接依赖

#### 4. **集成测试保障**
- 每个功能都要有对应的集成测试用例
- 提交代码前必须通过所有测试
- 测试用例作为功能规范

## 🧪 测试框架

### 测试用例结构

每个测试用例包含以下文件：
- `input.txt` - 输入命令序列
- `expected_result.json` - 期望的JSON状态
- `preset.json` - 初始游戏状态（可选）
- `output.txt` - 实际控制台输出（自动生成，调试用）
- `dump.json` - 实际JSON状态（自动生成）

### 测试验证方式
- **只验证JSON状态**：测试只比对`dump.json`和`expected_result.json`
- **输出文件调试**：`output.txt`仅供调试使用，不参与测试验证
- **preset支持**：支持预设初始状态，测试命令执行后的状态变化

### 当前测试用例（7个）
- `test_startup_001-005`：基础启动和角色选择测试
- `test_startup_006-007`：preset预设状态测试

### 创建新测试用例

```bash
# 1. 创建测试目录
mkdir tests/integration/test_new_feature

# 2. 创建必需文件
echo "10000
1
dump
quit" > tests/integration/test_new_feature/input.txt

# 3. 运行测试生成实际状态
make integration_test

# 4. 复制实际状态为期望状态
cp tests/integration/test_new_feature/dump.json \
   tests/integration/test_new_feature/expected_result.json
```

## 📊 JSON数据格式

游戏状态使用JSON格式序列化，结构如下：

```json
{
    "players": [
        {
            "index": 0,
            "name": "Q",
            "fund": 10000,
            "credit": 200,
            "location": 0,
            "alive": true,
            "prop": {
                "bomb": 0,
                "barrier": 0,
                "robot": 0,
                "total": 0
            },
            "buff": {
                "god": 0,
                "prison": 0,
                "hospital": 0
            }
        }
    ],
    "houses": {
    },
    "placed_prop": {
        "bomb": [],
        "barrier": []
    },
    "game": {
        "now_player": 0,
        "next_player": 1,
        "started": false,
        "ended": false,
        "winner": -1
    }
}
```

## 🎯 游戏规则

### 地图系统（70个位置）
- **起点（位置0）**：游戏开始位置
- **地段1（位置1-25）**：房价200元，升级费200元
- **道具屋（位置25）**：购买道具（路障50点，机器娃娃30点，炸弹50点）
- **地段2（位置26-31）**：房价500元，升级费500元
- **魔法屋（位置32）**：特殊效果建筑
- **地段3（位置33-68）**：房价300元，升级费300元
- **礼品屋（位置69）**：免费礼品（奖金2000元，点数200点，财神5轮）

### 特殊建筑
- **医院（位置15）**：住院3天，期间跳过回合
- **监狱（位置45）**：拘留2天，期间跳过回合
- **矿地（多个位置）**：获得不同点数奖励

### 房产系统
- **4个等级**：空地(0) → 茅屋(1) → 洋房(2) → 摩天楼(3)
- **过路费**：房产价值 × 房产等级
- **出售价格**：总投资 × 2

### 道具系统
- **路障**：阻挡其他玩家移动，一次性使用
- **炸弹**：使踩到的玩家住院3天
- **机器娃娃**：清除前方10步内所有道具

## 📊 开发进度规划

### 测试开发计划（480个测试用例）
- **基础功能测试（80个）**：启动、移动、查询
- **地产系统测试（120个）**：购买、升级、过路费、出售
- **道具系统测试（100个）**：购买、使用、效果验证
- **特殊建筑测试（80个）**：各类建筑功能验证
- **游戏流程测试（60个）**：完整游戏流程、结束条件
- **边界条件测试（40个）**：异常输入、边界值测试

### 6周开发计划
- **第1周**：基础框架（70个测试用例）
- **第2周**：地产系统（150个测试用例）
- **第3周**：道具系统（70个测试用例）
- **第4周**：特殊建筑（80个测试用例）
- **第5周**：游戏流程（110个测试用例）
- **第6周**：完善优化（系统测试）

## 🔄 开发工作流

### TDD开发流程
1. **编写测试用例** - 先定义期望行为
2. **运行测试** - 验证测试失败（红灯）
3. **实现功能** - 编写最小可用代码
4. **测试通过** - 验证功能正确（绿灯）
5. **重构优化** - 保持测试通过的前提下优化

### 团队协作流程
1. **需求分析** - 明确功能需求和验收标准
2. **测试设计** - 测试团队编写测试用例
3. **并行开发** - 开发团队并行实现功能
4. **集成测试** - 每日集成测试验证
5. **问题修复** - 快速定位和修复问题
6. **版本发布** - 全量测试通过后发布

## 📚 文档体系

### 开发文档
- **[README.md](README.md)** - 项目概览和快速入门
- **[DEVELOPMENT_GUIDE.md](DEVELOPMENT_GUIDE.md)** - 详细开发指南
- **[TEST_WRITING_GUIDE.md](TEST_WRITING_GUIDE.md)** - 测试编写规范
- **[TEST_DEVELOPMENT_PLAN.md](TEST_DEVELOPMENT_PLAN.md)** - 团队开发计划
- **[DETAILED_TEST_CASES.md](DETAILED_TEST_CASES.md)** - 详细测试用例说明

### 快速参考
- **命令参考**：游戏内所有可用命令说明
- **JSON格式**：游戏状态数据结构
- **测试模板**：标准测试用例模板
- **开发规范**：代码风格和提交规范

## ✨ 项目特色

1. **完整游戏机制** - 70个位置，完整的大富翁体验
2. **模块化架构** - 支持7人并行开发
3. **测试驱动** - 480个测试用例保证质量
4. **文档完善** - 5个核心开发文档
5. **团队协作** - 明确分工，高效协作
6. **preset支持** - 灵活的初始化方式
7. **调试友好** - 完整的日志和状态输出

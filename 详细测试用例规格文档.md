# 详细测试用例规格文档

## 📋 文档说明

本文档包含120个测试用例的详细规格，每个测试用例针对单一功能模块，包含preset.json、cmdlist.txt和expected_result.json的完整规格。

## 🎮 游戏流程测试（60个）

### 第一类：回合切换机制测试（15个）

#### test_turn_001 - 掷骰子后自动切换回合测试

**功能模块**：回合管理  
**测试目标**：验证掷骰子后自动切换到下一玩家回合

**测试描述**：
1. 使用preset加载双人游戏状态（钱夫人和阿土伯）
2. 当前玩家为钱夫人（now_player=0）
3. 钱夫人执行roll命令移动
4. 验证移动后自动切换到阿土伯（now_player=1）

**preset.json**：
```json
{
    "players": [
        {
            "index": 0, "name": "Q", "fund": 10000, "credit": 200,
            "location": 0, "alive": true,
            "prop": {"bomb": 0, "barrier": 0, "robot": 0, "total": 0},
            "buff": {"god": 0, "prison": 0, "hospital": 0}
        },
        {
            "index": 1, "name": "A", "fund": 10000, "credit": 200,
            "location": 0, "alive": true,
            "prop": {"bomb": 0, "barrier": 0, "robot": 0, "total": 0},
            "buff": {"god": 0, "prison": 0, "hospital": 0}
        }
    ],
    "houses": {},
    "placed_prop": {"bomb": [], "barrier": []},
    "game": {"now_player": 0, "next_player": 1, "started": true, "ended": false, "winner": -1}
}
```

**cmdlist.txt**：
```
step 3
dump
```

**验证内容**：
- 钱夫人移动到位置3
- now_player自动切换为1（阿土伯）
- next_player更新为0（回到钱夫人）
- 游戏状态保持started=true

**expected_result.json**：
```json
{
    "players": [
        {
            "index": 0, "name": "Q", "fund": 10000, "credit": 200,
            "location": 3, "alive": true,
            "prop": {"bomb": 0, "barrier": 0, "robot": 0, "total": 0},
            "buff": {"god": 0, "prison": 0, "hospital": 0}
        },
        {
            "index": 1, "name": "A", "fund": 10000, "credit": 200,
            "location": 0, "alive": true,
            "prop": {"bomb": 0, "barrier": 0, "robot": 0, "total": 0},
            "buff": {"god": 0, "prison": 0, "hospital": 0}
        }
    ],
    "houses": {},
    "placed_prop": {"bomb": [], "barrier": []},
    "game": {"now_player": 1, "next_player": 0, "started": true, "ended": false, "winner": -1}
}
```

---

#### test_turn_002 - 住院状态跳过回合测试

**功能模块**：回合管理  
**测试目标**：验证住院玩家的状态递减

**测试描述**：
1. 使用preset加载玩家住院状态（hospital=3）
2. 执行dump命令获取当前状态
3. 验证住院天数从3递减为2
4. 验证其他状态保持不变

**preset.json**：
```json
{
    "players": [
        {
            "index": 0, "name": "Q", "fund": 10000, "credit": 200,
            "location": 15, "alive": true,
            "prop": {"bomb": 0, "barrier": 0, "robot": 0, "total": 0},
            "buff": {"god": 0, "prison": 0, "hospital": 3}
        }
    ],
    "houses": {},
    "placed_prop": {"bomb": [], "barrier": []},
    "game": {"now_player": 0, "next_player": 0, "started": true, "ended": false, "winner": -1}
}
```

**cmdlist.txt**：
```
dump
```

**验证内容**：
- hospital状态从3递减为2
- 玩家其他属性保持不变
- 游戏状态保持started=true
- 玩家位置保持在15

**expected_result.json**：
```json
{
    "players": [
        {
            "index": 0, "name": "Q", "fund": 10000, "credit": 200,
            "location": 15, "alive": true,
            "prop": {"bomb": 0, "barrier": 0, "robot": 0, "total": 0},
            "buff": {"god": 0, "prison": 0, "hospital": 2}
        }
    ],
    "houses": {},
    "placed_prop": {"bomb": [], "barrier": []},
    "game": {"now_player": 0, "next_player": 0, "started": true, "ended": false, "winner": -1}
}
```

---

#### test_turn_003 - 掷骰子前后操作时机限制测试

**功能模块**：回合管理  
**测试目标**：验证掷骰子前可买卖房产，掷骰子后不可操作

**测试描述**：
1. 使用preset加载玩家拥有房产的状态
2. 在掷骰子前成功出售房产
3. 掷骰子移动后验证无法再进行房产操作

**preset.json**：
```json
{
    "players": [
        {
            "index": 0, "name": "Q", "fund": 10000, "credit": 200,
            "location": 5, "alive": true,
            "prop": {"bomb": 0, "barrier": 0, "robot": 0, "total": 0},
            "buff": {"god": 0, "prison": 0, "hospital": 0}
        }
    ],
    "houses": {
        "5": {"owner": "Q", "level": 1}
    },
    "placed_prop": {"bomb": [], "barrier": []},
    "game": {"now_player": 0, "next_player": 0, "started": true, "ended": false, "winner": -1}
}
```

**cmdlist.txt**：
```
sell 5
step 3
dump
```

**验证内容**：
- 掷骰子前成功出售房产
- 玩家资金增加（投资总额×2）
- 房产所有权清除
- 玩家移动到新位置

**expected_result.json**：
```json
{
    "players": [
        {
            "index": 0, "name": "Q", "fund": 10800, "credit": 200,
            "location": 8, "alive": true,
            "prop": {"bomb": 0, "barrier": 0, "robot": 0, "total": 0},
            "buff": {"god": 0, "prison": 0, "hospital": 0}
        }
    ],
    "houses": {},
    "placed_prop": {"bomb": [], "barrier": []},
    "game": {"now_player": 0, "next_player": 0, "started": true, "ended": false, "winner": -1}
}
```

---

### 第二类：自动购买询问机制测试（15个）

#### test_auto_001 - 资金足够时自动弹出购买询问

**功能模块**：自动购买询问  
**测试目标**：验证资金足够时到达空地自动弹出购买询问

**测试描述**：
1. 使用preset加载玩家有足够资金的状态
2. 玩家移动到空地（地段1，需要200元）
3. 验证自动弹出购买询问
4. 选择购买，验证资金扣除和房产获得

**preset.json**：
```json
{
    "players": [
        {
            "index": 0, "name": "Q", "fund": 10000, "credit": 200,
            "location": 0, "alive": true,
            "prop": {"bomb": 0, "barrier": 0, "robot": 0, "total": 0},
            "buff": {"god": 0, "prison": 0, "hospital": 0}
        }
    ],
    "houses": {},
    "placed_prop": {"bomb": [], "barrier": []},
    "game": {"now_player": 0, "next_player": 0, "started": true, "ended": false, "winner": -1}
}
```

**cmdlist.txt**：
```
step 5
y
dump
```

**验证内容**：
- 玩家移动到位置5
- 资金扣除200元（10000->9800）
- 获得位置5的0级房产
- 房产所有权正确设置

**expected_result.json**：
```json
{
    "players": [
        {
            "index": 0, "name": "Q", "fund": 9800, "credit": 200,
            "location": 5, "alive": true,
            "prop": {"bomb": 0, "barrier": 0, "robot": 0, "total": 0},
            "buff": {"god": 0, "prison": 0, "hospital": 0}
        }
    ],
    "houses": {
        "5": {"owner": "Q", "level": 0}
    },
    "placed_prop": {"bomb": [], "barrier": []},
    "game": {"now_player": 0, "next_player": 0, "started": true, "ended": false, "winner": -1}
}
```

---

#### test_auto_002 - 资金不足时无购买询问

**功能模块**：自动购买询问  
**测试目标**：验证资金不足时到达空地不显示购买询问

**测试描述**：
1. 使用preset加载玩家资金不足的状态（只有100元）
2. 玩家移动到地段1空地（需要200元）
3. 验证不显示购买询问
4. 验证玩家状态不变

**preset.json**：
```json
{
    "players": [
        {
            "index": 0, "name": "Q", "fund": 100, "credit": 200,
            "location": 0, "alive": true,
            "prop": {"bomb": 0, "barrier": 0, "robot": 0, "total": 0},
            "buff": {"god": 0, "prison": 0, "hospital": 0}
        }
    ],
    "houses": {},
    "placed_prop": {"bomb": [], "barrier": []},
    "game": {"now_player": 0, "next_player": 0, "started": true, "ended": false, "winner": -1}
}
```

**cmdlist.txt**：
```
step 5
dump
```

**验证内容**：
- 玩家移动到位置5
- 玩家资金保持100元不变
- 位置5保持空地状态
- houses结构保持为空

**expected_result.json**：
```json
{
    "players": [
        {
            "index": 0, "name": "Q", "fund": 100, "credit": 200,
            "location": 5, "alive": true,
            "prop": {"bomb": 0, "barrier": 0, "robot": 0, "total": 0},
            "buff": {"god": 0, "prison": 0, "hospital": 0}
        }
    ],
    "houses": {},
    "placed_prop": {"bomb": [], "barrier": []},
    "game": {"now_player": 0, "next_player": 0, "started": true, "ended": false, "winner": -1}
}
```

**功能模块**：完整游戏流程  
**测试目标**：验证破产导致的游戏结束流程

**测试描述**：
1. 初始化游戏：设置较低初始资金5000元，选择孙小美和金贝贝
2. 快速建立高价值房产，制造破产场景
3. 验证破产判定的准确性（扣费后资金<0）
4. 验证破产玩家立即退出，剩余玩家获胜

**输入命令序列**：
```
5000
34
# 快速购买和升级房产
step 26  # 到达地段2
buy      # 购买500元房产
upgrade 26  # 升级花费500元
# 继续操作直到资金不足
```

**验证内容**：
- 破产判定的精确条件（资金<0，不含=0）
- 破产玩家立即退出游戏
- 剩余玩家自动获胜
- 破产玩家房产自动回收

**预期结果**：
- 破产时游戏立即结束
- 获胜者正确确定
- 房产状态正确回收
- 游戏状态设为已结束

---

#### test_flow_003 - 三人游戏中途破产测试

**功能模块**：完整游戏流程  
**测试目标**：验证多人游戏中部分玩家破产的处理

**测试描述**：
1. 初始化游戏：选择3个角色进行游戏
2. 进行正常游戏流程
3. 故意制造一个玩家破产场景
4. 验证剩余2个玩家继续游戏
5. 最终决出唯一获胜者

**输入命令序列**：
```
8000
123
# 多轮游戏操作
# 制造玩家1破产
# 剩余玩家2和玩家3继续
```

**验证内容**：
- 破产玩家立即退出，不影响其他玩家
- 剩余玩家正确继续游戏
- 回合顺序正确调整
- 最终获胜者正确确定

**预期结果**：
- 破产玩家状态设为淘汰
- 游戏在剩余玩家间继续
- 最后一人获胜时游戏结束

---

### 第二类：回合管理测试（15个）

#### test_turn_001 - 正常回合轮换机制测试

**功能模块**：回合管理  
**测试目标**：验证掷骰子后自动切换回合的机制

**测试描述**：
1. 初始化双人游戏
2. 验证掷骰子前可以进行道具使用、房产买卖
3. 验证掷骰子后只能触发被动事件（购买询问、过路费等）
4. 验证完成所有被动事件后自动切换到下一玩家

**输入命令序列**：
```
10000
12
# 玩家1回合开始
sell 1    # 掷骰子前操作（如果有房产）
block 5   # 掷骰子前使用道具
roll      # 掷骰子，触发移动
# 自动处理购买询问等被动事件
# 自动切换到玩家2
dump
quit
```

**验证内容**：
- 掷骰子前可以执行主动操作
- 掷骰子后只能触发被动事件
- 被动事件处理完毕后自动切换回合
- now_player和next_player正确更新

**预期结果**：
- 回合切换自动进行
- 玩家操作时机严格受限
- JSON状态中回合信息正确

---

#### test_turn_002 - 住院期间回合跳过测试

**功能模块**：回合管理  
**测试目标**：验证住院玩家跳过回合并显示提示

**测试描述**：
1. 设置玩家住院状态（hospital=3）
2. 验证住院玩家回合被跳过
3. 验证显示"你的住院天数还有X天"
4. 验证住院天数正确递减
5. 验证住院结束后恢复正常回合

**输入命令序列**：
```
preset.json包含住院状态的玩家
dump
# 几个回合后验证住院天数递减
quit
```

**验证内容**：
- 住院玩家回合被完全跳过
- 正确显示住院天数提示
- 住院天数每回合递减1
- 天数为0时恢复正常

**预期结果**：
- 住院期间不能进行任何操作
- 提示信息正确显示
- 状态正确递减和恢复

---

#### test_turn_008 - 掷骰子后被动事件处理顺序测试

**功能模块**：回合管理  
**测试目标**：验证掷骰子后各种被动事件的处理顺序

**测试描述**：
1. 设置复杂场景：到达位置有房产可购买，同时会触发过路费
2. 掷骰子移动到该位置
3. 验证事件处理顺序：位置效果 → 过路费 → 购买询问
4. 验证玩家只能响应询问，不能主动操作

**输入命令序列**：
```
预设场景
roll  # 移动到复杂位置
# 只能响应系统询问，不能主动操作
```

**验证内容**：
- 被动事件按正确顺序触发
- 玩家无法执行主动命令
- 所有被动事件处理完毕后自动切换回合

**预期结果**：
- 事件处理顺序正确
- 玩家操作受到严格限制
- 回合切换时机准确

---

### 第三类：胜负判定测试（10个）

#### test_win_001 - 破产条件精确判定测试

**功能模块**：胜负判定  
**测试目标**：验证扣除过路费后资金小于0的破产判定

**测试描述**：
1. 设置玩家资金恰好等于即将支付的过路费
2. 玩家移动到需要支付过路费的位置
3. 验证资金=0时不破产
4. 设置资金略少于过路费的场景
5. 验证资金<0时立即破产

**输入命令序列**：
```
# 场景1：资金=过路费，不破产
preset.json设置玩家资金=200，需支付200过路费
step 到达收费位置
dump  # 验证资金=0，未破产

# 场景2：资金<过路费，破产
preset.json设置玩家资金=100，需支付200过路费
step 到达收费位置
dump  # 验证游戏结束，玩家破产
```

**验证内容**：
- 资金=0时玩家不破产
- 资金<0时玩家立即破产
- 破产判定的精确临界条件
- 破产后游戏状态正确设置

**预期结果**：
- 破产判定准确无误
- 边界条件处理正确
- 游戏状态更新及时

---

#### test_win_002 - 掷骰子前出售房产避免破产测试

**功能模块**：胜负判定  
**测试目标**：验证玩家可在掷骰子前通过出售房产避免破产

**测试描述**：
1. 设置玩家资金不足，但拥有房产
2. 玩家预知将面临高额过路费
3. 在掷骰子前出售房产获得资金
4. 掷骰子后支付过路费，避免破产

**输入命令序列**：
```
preset.json设置低资金但有房产的场景
sell 位置  # 掷骰子前出售房产
roll      # 掷骰子移动
# 支付过路费后仍有资金，未破产
```

**验证内容**：
- 掷骰子前可以出售房产
- 房产出售价格=投资总额×2
- 获得资金后可避免破产
- 掷骰子后无法出售房产

**预期结果**：
- 房产交易时机正确
- 破产避免机制有效
- 操作时机限制正确

---

### 第四类：特殊状态交互测试（10个）

#### test_status_001 - 财神状态免疫过路费测试

**功能模块**：特殊状态交互  
**测试目标**：验证财神状态下玩家免疫过路费的效果

**测试描述**：
1. 设置玩家拥有财神状态（god=5）
2. 玩家移动到其他玩家的高级房产
3. 验证不需要支付过路费
4. 验证财神状态回合数正确递减
5. 验证财神状态结束后恢复正常收费

**输入命令序列**：
```
preset.json设置财神状态和高价房产场景
step 到达高价房产位置
dump  # 验证未扣除过路费
# 几个回合后验证财神状态递减
```

**验证内容**：
- 财神状态下免疫过路费
- 财神状态持续5个回合
- 每回合财神状态递减1
- 财神状态结束后恢复正常

**预期结果**：
- 过路费免疫效果正确
- 状态持续时间准确
- 状态结束后行为正常

---

#### test_status_002 - 财神状态不免疫炸弹住院测试

**功能模块**：特殊状态交互  
**测试目标**：验证财神状态不免疫炸弹伤害和住院效果

**测试描述**：
1. 设置玩家拥有财神状态
2. 玩家移动到有炸弹的位置
3. 验证炸弹正常爆炸，玩家住院3天
4. 验证财神状态和住院状态可以叠加
5. 验证各状态独立计算

**输入命令序列**：
```
preset.json设置财神状态和炸弹位置
step 到达炸弹位置
dump  # 验证同时有财神和住院状态
```

**验证内容**：
- 财神状态不免疫炸弹伤害
- 炸弹触发正常住院效果
- 财神和住院状态可以叠加
- 各状态独立计算递减

**预期结果**：
- 财神状态范围限制正确
- 多重状态叠加正常
- 状态计算独立准确

---

## 🚧 边界条件测试（40个）

### 第一类：输入验证测试（15个）

#### test_input_001 - 完全无效命令处理测试

**功能模块**：输入验证  
**测试目标**：验证输入完全无效命令时的错误处理

**测试描述**：
1. 在正常游戏状态下输入完全无效的命令
2. 验证系统提示"输入错误"
3. 验证游戏状态不发生任何改变
4. 验证重新提示可接受的命令

**输入命令序列**：
```
10000
1
xyz123  # 完全无效的命令
dump    # 验证状态未改变
quit
```

**验证内容**：
- 无效命令不改变游戏状态
- 显示错误提示信息
- 重新等待有效命令输入
- 游戏可以继续正常进行

**预期结果**：
- 错误处理机制正确
- 游戏状态保持稳定
- 用户体验友好

---

#### test_input_002 - 道具屋中输入无效命令测试

**功能模块**：输入验证  
**测试目标**：验证在特殊场景下的无效命令处理

**测试描述**：
1. 玩家移动到道具屋（位置25）
2. 在道具屋菜单状态下输入roll命令
3. 验证不做任何状态改变
4. 验证显示错误提示
5. 验证重新显示道具屋菜单

**输入命令序列**：
```
10000
1
step 25  # 到达道具屋
roll     # 在道具屋中输入无效命令
F        # 退出道具屋
dump
quit
```

**验证内容**：
- 特殊状态下的命令验证
- 错误提示的准确性
- 状态不受无效命令影响
- 正确返回特殊菜单

**预期结果**：
- 特殊场景错误处理正确
- 菜单状态保持稳定
- 用户引导清晰

---

#### test_input_006 - 道具放置超出范围测试

**功能模块**：输入验证  
**测试目标**：验证道具放置位置超出前后10步范围的处理

**测试描述**：
1. 玩家拥有路障道具
2. 当前位置为10
3. 尝试使用block 15（超出前后10步范围）
4. 验证提示输入正确命令
5. 验证道具未被消耗

**输入命令序列**：
```
preset.json设置玩家在位置10且有路障
block 15  # 超出范围的放置尝试
dump      # 验证道具未消耗
quit
```

**验证内容**：
- 超出范围的放置被阻止
- 道具数量不减少
- 显示正确的错误提示
- 前后10步范围计算正确

**预期结果**：
- 范围限制严格执行
- 道具状态保持不变
- 错误信息清晰准确

---

### 第二类：资源边界测试（10个）

#### test_resource_001 - 道具总数达到10个限制测试

**功能模块**：资源边界  
**测试目标**：验证玩家道具总数不超过10个的限制

**测试描述**：
1. 设置玩家已拥有10个道具（bomb+barrier+robot=10）
2. 玩家到达道具屋尝试购买更多道具
3. 验证购买被阻止或给出相应提示
4. 验证道具总数保持10个不变

**输入命令序列**：
```
preset.json设置道具总数=10的玩家
step 25   # 到达道具屋
1         # 尝试购买路障
dump      # 验证道具数未增加
quit
```

**验证内容**：
- 道具总数上限严格控制
- 超限购买被正确阻止
- 道具数量统计准确
- 购买失败处理得当

**预期结果**：
- 道具上限机制有效
- 状态保持一致性
- 错误处理恰当

---

#### test_resource_004 - 破产临界值精确测试

**功能模块**：资源边界  
**测试目标**：验证资金=0与资金<0的破产判定边界

**测试描述**：
1. 场景1：设置玩家资金=200，过路费=200
2. 验证支付后资金=0，玩家不破产
3. 场景2：设置玩家资金=199，过路费=200  
4. 验证支付后资金=-1，玩家破产

**输入命令序列**：
```
# 场景1测试
preset.json设置资金=200，即将遇到200过路费
step 到达收费位置
dump  # 验证资金=0，alive=true

# 场景2测试  
preset.json设置资金=199，即将遇到200过路费
step 到达收费位置
dump  # 验证游戏结束，玩家破产
```

**验证内容**：
- 资金=0不触发破产
- 资金<0立即触发破产
- 破产边界值计算精确
- 破产状态设置正确

**预期结果**：
- 破产临界值判定准确
- 边界条件处理正确
- 游戏状态更新及时

---

这样的详细程度可以吗？我会继续以这个详细度编写所有120个测试用例的完整规格。每个测试用例都包含：

1. **功能模块**和**测试目标**
2. **详细的测试描述**（步骤化）
3. **具体的输入命令序列**
4. **明确的验证内容**
5. **清晰的预期结果**

您希望我继续编写完整的120个测试用例吗？
